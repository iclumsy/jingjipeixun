<view class="page">
  <view class="header-bg"></view>

  <view wx:if="{{student}}" class="container">
    <view class="section-card summary-card fade-enter">
      <view class="summary-row">
        <view class="summary-title">审核详情</view>
        <view class="status-tag status-{{student.status}}">{{statusText}}</view>
      </view>
      <view class="summary-meta">提交人：{{student.name || '-'}}</view>
      <view class="summary-meta">培训类型：{{trainingTypeText}}</view>
      <view class="summary-meta">公司：{{student.company || '-'}}</view>
      <view class="summary-meta">提交时间：{{submitTimeText}}</view>
      <view class="summary-meta" wx:if="{{student.reviewed_at}}">审核时间：{{reviewTimeText}}</view>
    </view>

    <student-form
      trainingType="{{trainingType}}"
      formData="{{editStudent}}"
      educationOptions="{{educationOptions}}"
      jobCategoryNames="{{jobCategoryNames}}"
      fieldErrors="{{fieldErrors}}"
      showAgreement="{{false}}"
      showSubmit="{{false}}"
      trainingCardTitle="培训信息"
      attachmentsTip="可直接替换附件，未替换的附件会保留原记录。"
      bind:trainingtypechange="selectTrainingType"
      bind:genderchange="selectGender"
      bind:inputchange="onInputChange"
      bind:idcardblur="onIdCardBlur"
      bind:phoneblur="onPhoneBlur"
      bind:educationchange="onEducationChange"
      bind:jobcategorychange="onJobCategoryChange"
      bind:examprojectchange="onExamProjectChange"
      bind:fileuploaded="onFileUploaded"
      bind:filedeleted="onFileDeleted"
    />
  </view>

  <view class="bottom-actions" wx:if="{{student}}">
    <button
      class="action-btn btn-save"
      bindtap="onSave"
      loading="{{saving}}"
      disabled="{{saving || actionLoading || loading}}"
    >保存</button>
    <button
      class="action-btn btn-approve {{!canReview ? 'disabled' : ''}}"
      bindtap="onApprove"
      loading="{{actionLoading && actionType === 'approve'}}"
      disabled="{{!canReview || saving || actionLoading || loading}}"
    >审核通过</button>
    <button
      class="action-btn btn-reject {{!canReview ? 'disabled' : ''}}"
      bindtap="onReject"
      loading="{{actionLoading && actionType === 'reject'}}"
      disabled="{{!canReview || saving || actionLoading || loading}}"
    >驳回</button>
  </view>

  <view class="readonly-hint" wx:if="{{student && !canReview}}">当前不是待审核状态，仅支持保存</view>
  <view class="loading" wx:if="{{loading}}">加载中...</view>
</view>
