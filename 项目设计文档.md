# 特种作业人员学员信息采集系统设计文档

## 1. 项目概述

### 1.1 项目背景

随着特种作业人员培训需求的不断增加，传统的手工信息采集和管理方式已无法满足高效、准确的管理需求。为了提高特种作业人员培训信息的管理效率，规范培训流程，特开发此学员信息采集系统。

### 1.2 项目目标

- 实现学员信息的电子化采集和管理
- 提供便捷的文件上传和管理功能
- 实现学员信息的审核和状态跟踪
- 自动生成体检表等相关文档
- 支持数据导出和批量操作
- 提供友好的用户界面和管理界面

### 1.3 设计原则

- **易用性**：界面简洁直观，操作流程清晰
- **可靠性**：数据存储安全可靠，系统运行稳定
- **扩展性**：系统架构灵活，便于后续功能扩展
- **安全性**：保护学员个人信息安全
- **效率性**：提高信息采集和管理效率
- 本系统所有提示、确认、警告均使用页面内轻量级组件，禁止调用系统级弹框


## 2. 系统架构

### 2.1 技术栈

| 类别 | 技术/框架 | 版本 | 用途 |
|------|-----------|------|------|
| 后端 | Python | 3.11+ | 核心编程语言 |
| 后端框架 | Flask | - | Web应用框架 |
| 数据库 | SQLite | - | 轻量级数据库存储 |
| 文档处理 | python-docx | - | 生成Word文档（体检表） |
| 图像处理 | PIL (Pillow) | - | 图像处理和编辑 |
| 图像处理 | rembg | - | 照片背景处理 |
| 前端 | HTML5 | - | 页面结构 |
| 前端 | CSS3 | - | 页面样式 |
| 前端 | JavaScript | ES6+ | 前端交互逻辑 |


## 3. 核心功能模块

### 3.1 学员信息录入模块

**功能描述**：
- 支持批量录入学员信息
- 收集学员基本信息（姓名、性别、学历等）
- 收集学员证件信息（身份证号、手机号等）
- 收集学员工作信息（单位名称、作业类别等）
- 支持上传相关证件和照片

**详细需求**：

1. **批量录入功能**
   - 可动态添加多个学员表单
   - 每个学员表单独立提交和验证
   - 支持批量提交所有学员信息

2. **表单字段设计**
   
   | 字段名称 | 类型 | 必填 | 格式要求 | 说明 |
   |---------|------|------|----------|------|
   | 姓名 | 文本 | 是 | 2-20个汉字 | 学员真实姓名 |
   | 性别 | 下拉选择 | 是 | 男/女 | 学员性别 |
   | 文化程度 | 下拉选择 | 是 | 初中/高中/中专/专科/本科/研究生及以上 | 学员最高学历 |
   | 毕业院校 | 文本 | 否 | 50个字符以内 | 学员毕业院校名称 |
   | 所学专业 | 文本 | 否 | 50个字符以内 | 学员所学专业 |
   | 身份证号 | 文本 | 是 | 18位数字/字母 | 学员身份证号码，最后一位可为X |
   | 手机号 | 文本 | 是 | 11位数字 | 学员手机号码 |
   | 单位名称 | 文本 | 否 | 100个字符以内 | 学员所在单位名称 |
   | 单位地址 | 文本 | 否 | 200个字符以内 | 学员单位详细地址 |
   | 作业类别 | 下拉选择 | 是 | 见作业类别列表 | 学员从事的特种作业类别 |
   | 操作项目 | 下拉选择 | 是 | 见操作项目列表 | 根据作业类别联动显示 |
   | 项目代码 | 文本 | 否 | 10个字符以内 | 操作项目对应的代码 |
   | 考试类别 | 下拉选择 | 是 | 初次领证/复审/延期换证 | 学员参加的考试类型 |

3. **作业类别与操作项目关联**
   
   | 作业类别 | 操作项目 | 项目代码示例 |
   |---------|---------|-------------|
   | 电工作业 | 低压电工作业 | 1.1 |
   | 电工作业 | 高压电工作业 | 1.2 |
   | 电工作业 | 电力电缆作业 | 1.3 |
   | 电工作业 | 电气试验作业 | 1.4 |
   | 电工作业 | 继电保护作业 | 1.5 |
   | 电工作业 | 防爆电气作业 | 1.6 |
   | 焊接与热切割作业 | 熔化焊接与热切割作业 | 2.1 |
   | 高处作业 | 高处安装、维护、拆除作业 | 3.1 |
   | 高处作业 | 登高架设作业 | 3.2 |

4. **文件上传要求**
   
   | 文件类型 | 必填 | 格式要求 | 大小限制 | 说明 |
   |---------|------|----------|----------|------|
   | 个人照片 | 是 | JPG/PNG | 2MB以内 | 近期免冠证件照 |
   | 学历证书 | 否 | JPG/PNG | 2MB以内 | 学历证书扫描件 |
   | 所持证件正面 | 否 | JPG/PNG | 2MB以内 | 现有特种作业证件正面 |
   | 所持证件反面 | 否 | JPG/PNG | 2MB以内 | 现有特种作业证件反面 |
   | 身份证正面 | 是 | JPG/PNG | 2MB以内 | 身份证人像面 |
   | 身份证反面 | 是 | JPG/PNG | 2MB以内 | 身份证国徽面 |

**实现细节**：
- 前端使用HTML表单和JavaScript实现动态添加学员表单
- 后端使用Flask接收表单数据和文件
- 数据验证确保必填字段和格式正确
- 文件上传后按公司和姓名组织存储

### 3.2 管理员审核模块

**功能描述**：
- 查看待审核学员列表
- 审核学员信息和上传文件
- 审核通过/不通过操作
- 批量审核功能

**详细需求**：

1. **学员状态管理**
   
   | 状态 | 说明 | 操作权限 |
   |------|------|----------|
   | 未审核 | 学员信息已提交，等待管理员审核 | 可审核通过/不通过 |
   | 已审核 | 学员信息已审核通过，等待考试安排 | 可查看详情，生成体检表 |
   | 已考试 | 学员已参加考试| 标记是否通过 |

2. **审核流程**
   - 管理员登录系统后，默认显示待审核学员列表
   - 点击学员列表项，查看学员详细信息和上传文件
   - 审核学员信息的真实性和完整性
   - 审核上传文件的清晰度和有效性
   - 点击"审核通过"或"审核不通过"按钮完成审核

3. **批量操作功能**
   - 支持勾选多个学员进行批量操作
   - 批量审核通过：将选中的学员状态更新为已审核
   - 批量审核不通过：删除选中的学员信息和相关文件
   - 批量删除：删除选中的学员信息和相关文件

4. **审核标准**
   - 信息完整性：所有必填字段是否填写完整
   - 信息真实性：身份证号、手机号等格式是否正确
   - 文件清晰度：上传的照片和证件是否清晰可辨
   - 文件完整性：身份证正反面、个人照片等是否齐全

**实现细节**：
- 管理员页面使用标签页区分不同状态的学员
- 审核操作更新学员状态
- 批量操作提高审核效率
- 审核通过后可生成体检表

### 3.3 体检表生成模块

**功能描述**：
- 根据学员信息自动生成体检表
- 自动填充学员基本信息
- 插入学员照片

**详细需求**：

1. **体检表内容**
   
   | 部分 | 内容 | 来源 |
   |------|------|------|
   | 基本信息 | 姓名、性别、身份证号 | 学员信息表 |
   | 申请信息 | 申请作业种类、申请作业项目（代号） | 学员信息表 |
   | 照片 | 学员近期免冠证件照 | 上传的个人照片 |
   | 体检项目 | 视力、听力、辨色力、血压、心电图等 | 模板固定内容 |
   | 体检结论 | 健康状况、医生签名、日期 | 模板固定格式，需手动填写 |

2. **生成流程**
   - 管理员在学员详情页面点击"生成体检表"按钮
   - 系统自动读取学员信息和上传的照片
   - 根据模板生成Word格式的体检表
   - 体检表自动保存到学员文件夹中
   - 系统提供体检表下载链接

3. **格式要求**
   - 体检表使用标准A4纸张大小
   - 照片位置预留1英寸照片大小（2.5cm×3.5cm）
   - 文字格式统一，字体为宋体，大小适中
   - 表格边框清晰，内容对齐整齐
   - 生成的文档为.docx格式

4. **照片处理**
   - 自动调整上传照片的大小和位置
   - 确保照片清晰可见
   - 照片背景处理为白色（如果上传的照片背景不是白色）使用 rembg 包处理

**实现细节**：
- 使用python-docx库xml级操作Word文档
- 读取模板文件并替换内容
- 处理照片大小和位置
- 生成的文档存储在学员文件夹中

### 3.4 数据导出模块

**功能描述**：
- 导出学员信息为Excel文件
- 支持按状态和公司筛选导出
- 导出文件包含学员基本信息和考试信息

**详细需求**：

1. **导出内容**
   
   | 列名 | 数据来源 | 说明 |
   |------|----------|------|
   | ID | 学员ID | 系统自动生成的学员编号 |
   | 姓名 | 学员姓名 | 学员真实姓名 |
   | 性别 | 学员性别 | 男/女 |
   | 文化程度 | 文化程度 | 学员最高学历 |
   | 毕业院校 | 毕业院校 | 学员毕业院校名称 |
   | 所学专业 | 所学专业 | 学员所学专业 |
   | 身份证号 | 身份证号 | 学员身份证号码 |
   | 手机号 | 手机号 | 学员手机号码 |
   | 单位名称 | 单位名称 | 学员所在单位名称 |
   | 单位地址 | 单位地址 | 学员单位详细地址 |
   | 作业类别 | 作业类别 | 学员从事的特种作业类别 |
   | 操作项目 | 操作项目 | 学员操作项目 |
   | 项目代码 | 项目代码 | 操作项目对应的代码 |
   | 考试类别 | 考试类别 | 学员参加的考试类型 |
   | 状态 | 状态 | 学员当前状态 |
   | 创建时间 | 创建时间 | 学员信息提交时间 |
   | 理论考试时间 | 理论考试时间 | 学员理论考试时间 |
   | 实操考试时间 | 实操考试时间 | 学员实操考试时间 |
   | 是否通过 | 是否通过 | 学员考试是否通过 |
   | 理论补考时间 | 理论补考时间 | 学员理论补考时间 |
   | 是否补考 | 是否补考 | 学员是否参加补考 |

2. **筛选条件**
   - 状态筛选：全部/未审核/已审核/已考试
   - 公司筛选：全部/特定公司
   - 考试结果筛选：全部/通过/未通过（仅对已考试状态有效）

3. **导出流程**
   - 管理员点击"导出Excel"按钮
   - 系统弹出导出选项对话框
   - 管理员选择导出条件
   - 点击"开始导出"按钮
   - 系统生成Excel文件并提供下载

4. **格式要求**
   - Excel文件使用.xlsx格式
   - 表头使用加粗字体，背景色为浅灰色
   - 数据行使用普通字体
   - 列宽自动调整，确保内容完整显示
   - 日期格式统一为"YYYY-MM-DD"

**实现细节**：
- 使用openpyxl库生成Excel文件
- 动态构建查询条件
- 设置Excel样式和格式
- 提供文件下载功能

### 3.5 批量操作模块

**功能描述**：
- 批量审核通过
- 批量审核不通过
- 批量删除学员信息

**详细需求**：

1. **批量操作功能**
   
   | 操作类型 | 功能描述 | 适用状态 | 影响 |
   |---------|----------|----------|------|
   | 批量审核通过 | 将选中的学员状态更新为已审核 | 未审核 | 更新学员状态，生成体检表 |
   | 批量审核不通过 | 删除选中的学员信息和相关文件 | 未审核 | 删除学员记录和关联文件 |
   | 批量删除 | 删除选中的学员信息和相关文件 | 所有状态 | 删除学员记录和关联文件 |

2. **操作流程**
   - 在学员列表页面，勾选需要操作的学员
   - 点击相应的批量操作按钮
   - 系统弹出确认对话框，显示选中的学员数量
   - 管理员确认后，系统执行批量操作
   - 操作完成后，系统显示操作结果提示

3. **操作限制**
   - 一次最多支持选择100个学员进行批量操作
   - 批量审核通过仅适用于未审核状态的学员
   - 批量操作执行过程中，系统会锁定相关学员记录，防止并发操作

4. **文件处理**
   - 批量审核不通过和批量删除操作会同时删除学员的所有关联文件
   - 删除的文件包括：个人照片、学历证书、所持证件、身份证正反面、体检表等
   - 文件删除后无法恢复，请谨慎操作

**实现细节**：
- 前端实现多选功能
- 后端接收学员ID列表
- 批量执行相应操作
- 处理关联文件的删除


## 6. 前端界面设计

### 6.1 学员信息录入页面

**页面结构**：
- 页面标题和logo
- 学员信息表单（可动态添加多个学员）
- 表单字段：姓名、性别、文化程度、身份证号、手机号、毕业院校、所学专业、单位名称、单位地址、作业类别、操作项目、项目代码、考试类别
- 文件上传：个人照片、学历证书、所持证件正面/反面、身份证正面/反面
- 提交按钮

**详细需求**：

1. **页面布局**
   - 顶部：系统标题和logo
   - 中部：学员信息表单区域
   - 底部：操作按钮区域

2. **表单设计**
   - 表单采用网格布局，响应式设计
   - 每个学员表单包含所有必要字段
   - 表单字段按逻辑分组排列
   - 文件上传区域采用拖拽上传和点击上传两种方式

3. **作业类别二级联动**
   - 作业类别下拉选择框：包含电工作业、焊接与热切割作业、高处作业等选项
   - 操作项目下拉选择框：初始状态为禁用
   - 联动逻辑：
     - 当选择作业类别后，操作项目下拉框自动启用
     - 系统根据选择的作业类别，动态加载对应的操作项目选项
     - 例如：选择"电工作业"后，操作项目显示"低压电工作业"、"高压电工作业"等选项

4. **表单验证**
   - 实时验证：输入时立即验证格式是否正确
   - 提交验证：提交时验证所有必填字段是否填写
   - 验证规则：
     - 姓名：2-20个汉字
     - 身份证号：18位数字/字母
     - 手机号：11位数字
     - 文件类型：仅支持JPG/PNG格式
     - 文件大小：不超过2MB

5. **文件上传预览**
   - 上传文件后，显示文件预览图
   - 支持点击预览图查看大图
   - 支持替换已上传的文件

6. **批量提交**
   - 点击"提交所有信息"按钮，一次性提交所有学员信息
   - 提交过程中显示加载动画
   - 提交完成后显示成功/失败提示
   - 成功后可选择继续添加学员或返回首页

**交互逻辑**：
- 动态添加/删除学员表单
- 作业类别和操作项目二级联动
- 表单验证
- 文件上传预览
- 批量提交

### 6.2 管理员页面

**页面结构**：
- 侧边栏：搜索框、状态标签页、导出按钮、筛选条件
- 学员列表：显示学员姓名、单位、作业类别等基本信息
- 主内容区：学员详细信息、附件预览、操作按钮

**详细需求**：

1. **页面布局**
   - 左侧：侧边栏，包含导航和筛选功能
   - 右侧：主内容区，显示学员详情或操作结果
   - 响应式设计：在移动设备上，侧边栏可折叠

2. **侧边栏功能**
   - 顶部：搜索框，支持按姓名、身份证号、手机号搜索
   - 中部：状态标签页，包含未审核、已审核、已考试三个标签
   - 底部：筛选条件，包含公司名称和考试结果筛选

3. **学员列表**
   - 显示学员基本信息：姓名、单位名称、作业类别、身份证号后四位
   - 支持单选和多选功能
   - 列表项悬停效果：显示详细信息预览
   - 支持列表排序：默认按创建时间倒序排列

4. **主内容区**
   - 学员详情：显示学员所有信息，包括基本信息、考试信息等
   - 附件预览：显示上传的照片和证件，支持点击放大查看
   - 操作按钮：根据学员状态显示不同的操作按钮
   - 考试信息录入：已考试状态的学员可录入考试时间和成绩

5. **交互逻辑**
   - 点击学员列表项，在主内容区显示该学员的详细信息
   - 点击状态标签页，切换显示对应状态的学员列表
   - 输入搜索关键词，实时筛选学员列表
   - 选择筛选条件，动态更新学员列表
   - 点击操作按钮，执行相应操作并显示操作结果

6. **批量操作栏**
   - 位于学员列表上方
   - 显示选中的学员数量
   - 提供批量审核通过、批量审核不通过、批量删除按钮
   - 按钮状态根据选中的学员状态动态变化

7. **导出功能**
   - 点击导出按钮，弹出导出选项对话框
   - 支持按状态和公司筛选导出
   - 点击开始导出按钮，生成Excel文件并提供下载

8. **消息提示**
   - 操作成功/失败的消息提示
   - 批量操作结果的消息提示
   - 导出进度和结果的消息提示
   - 提示消息自动消失，不干扰用户操作

## 7. 安全与性能优化

### 7.1 安全措施

- **输入验证**：服务端验证所有用户输入，防止恶意数据
- **文件上传安全**：限制文件类型和大小，使用安全的文件存储路径
- **SQL注入防护**：使用参数化查询，避免SQL注入攻击
- **错误处理**：统一错误处理，避免暴露敏感信息
- **文件访问控制**：确保只有授权用户能访问文件

### 7.2 性能优化

- **数据库优化**：使用合适的索引，优化查询语句
- **文件存储优化**：按公司和姓名组织文件，提高文件管理效率
- **前端优化**：使用事件委托，减少DOM操作，优化渲染性能
- **批量操作**：减少数据库操作次数，提高处理效率
- **缓存策略**：合理使用缓存，减少重复计算